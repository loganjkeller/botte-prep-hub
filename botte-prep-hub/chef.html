<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Botte Restaurants® • Chef</title>
  <link rel="stylesheet" href=".botte-prep-hub/assets/app.css" />
</head>
<body>
  <div class="app">
    <header class="topbar">
      <a class="back" href="./index.html">←</a>
      <div>
        <div class="brand-title">Chef</div>
        <div class="brand-sub">Prep Plan</div>
      </div>
      <div></div>
    </header>

    <main class="card">
      <h1>Create Plan</h1>
      <p class="muted">This creates the plan rows in the Google Sheet for that date.</p>

      <div class="row">
        <label class="label">Plan date (YYYY-MM-DD)</label>
        <input id="planDate" class="input" placeholder="2026-01-07" />
      </div>

      <button id="btnCreate" class="btn btn-primary">Create Plan</button>

      <div class="spacer"></div>
      <div id="status" class="status muted">Ready.</div>

      <pre id="out" class="codebox"></pre>
    </main>

    <footer class="footer muted">Botte Restaurants® • Chef </footer>
  </div>

<script>
async function api(payload) {
  // Calls Cloudflare Function at /api (we will create it)
  const res = await fetch("/api", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(payload)
  });
  const text = await res.text();
  try { return JSON.parse(text); }
  catch { throw new Error("Non-JSON response: " + text.slice(0, 300)); }
}

const outEl = document.getElementById("out");
const statusEl = document.getElementById("status");
function setStatus(msg){ statusEl.textContent = msg; }
function setOut(obj){ outEl.textContent = obj ? JSON.stringify(obj, null, 2) : ""; }

function defaultNextWednesday() {
  const d = new Date();
  // next Wednesday (0=Sun..3=Wed)
  const target = 3;
  const diff = (target + 7 - d.getDay()) % 7 || 7;
  d.setDate(d.getDate() + diff);
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,"0");
  const day = String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${day}`;
}
document.getElementById("planDate").value = defaultNextWednesday();

document.getElementById("btnCreate").onclick = async () => {
  try {
    const plan_date = document.getElementById("planDate").value.trim();
    if (!plan_date) { setStatus("Enter a date."); return; }
    setStatus("Creating plan...");
    setOut(null);
    const data = await api({ action: "createPlan", plan_date });
    setOut(data);
    setStatus(data.ok ? "Done ✅" : "Error ❌");
  } catch (e) {
    setStatus("Error ❌");
    setOut({ ok:false, error: e?.message || String(e) });
  }
};
</script>
</body>
</html>
